---
title: "Tokyo 2020 Betting: My Stakes (Holding Post)"
description: |
  A holding post with the stakes I'm betting on the Individual Sprint. In the imminent future this post will be replaced by a full analysis of how I used draws from the Bradley-Terry model to derive the posterior distribution for the Gold medal winners of the track cycling Individual sprint. And how these were combined with the Kelly Criterion to derive optimised betting stakes under uncertainty.
date: 08-03-2021
output:
  distill::distill_article:
    toc: true
    toc_depth: 2
  self_contained: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, code_folding = TRUE)
options(kableExtra.html.bsTable = T)

library(tidyverse)
library(lubridate)
library(infreqthemes)
library(xaringanExtra)
library(knitr)
library(kableExtra)
library(fst)
library(formattable)

xaringanExtra::use_panelset()

remote_project_path <- '~/Documents/R Projects/track-cycling/'
remote_targets_path <- paste0(remote_project_path, '_targets/objects/')

read_remote_target <- function(name, path = remote_targets_path){
  
  file_path <- paste0(path,name)
  
  tar <- try(read_rds(file_path),silent=TRUE)
  
  if(class(tar) != 'try-error'){return(tar)}
  
  tar <- try(read_fst(file_path),silent=TRUE)
  
  if(class(tar) != 'try-error'){return(tar)}
  else{stop("Failed to read remote target")}
}

```

With the qualifying rounds of the Men's individual sprint starting tomorrow, its time to put some money behind my analysis.

The analytical workflow to go from model optimisation through to betting stakes are complete, but drafting a full blog post detailing how I've gone from predicting individual matches to entire tournaments, and then the defining betting stakes was beyond me in the time available.

<aside>All that detail in code form is available [here](https://github.com/odaniel1/track-cycling).</aside> 

In due course this blog post will morph to contain the details of the analysis - but for now this will be a holding space to report the odds I was being offered, and the and the stakes I put against these.

## Budget and Schedule

In total I'm allowing myself a budget of £20 - not exactly betting big, but also a non-negligible amount which will give me the flexibility to make a number of bets.

Going into the event I'm expecting to bet a total of six times (each time potentially spreading on multiple outcomes): three times for each of the Men/Women's events, and within the genders betting at three stages: before qualifying, after qualifying, and at one of the later rounds (to be decided which)!

My model will reccomend a fraction of my total budget to bet at each stage; to avoid blowing my budget early I'll also cap my expenditure in earlier rounds at 1/6 of the total budget: i.e. the max the strategy will allow me to spend on the pre-qualifying Men/Women's bet is £3.33.

<aside>My stakes are derived from an non-linear optimisation problem that extends the basic [Kelly Criterion](https://en.wikipedia.org/wiki/Kelly_criterion) to handle multi-bet scenarios.</aside>

## Pre-Qualifying

The idea of betting at this point is that hopefully the bookies odds are naive, as they won't have adjusted for qualifying times. We saw in the [previous post](https://www.infreq.com/posts/2021-07-28-tokyo-2020-ii/) qualifying data is highly predictive of match results.

In practice the odds will have already started shifting as a number of the athletes competing in the individual sprint have already taken part in other events. The most direct comparison is likely to the team sprint which has already seen medals go to:

| | Men | Women |
|:-:|---|---|
|Gold |*Netherlands*<br> **Jeffrey Hoogland<br>Harrie Lavreysen**<br>Roy van den Berg | *China*<br>**Bao Shanju<br>Zhong Tianshi** |
|Silver| *Great Britain*<br>**Jack Carlin<br>Jason Kenny<br>**Ryan Owens | *Germany*<br>**Lea Friedrich<br>Emma Hinze** |
|Bronze| *France*<br>Florian Grengbo<br>**Rayan Helal<br>Sébastien Vigier** |*Russian Olympic Comity*<br>**Daria Shmeleva<br>Anastasia Voynova** |

<aside>Athletes in bold are competing in the individual sprint.</aside>

I won't explicitly take this into account in modelling my stakes - but might then cap the stakes if I think the model is being overly confident.

The final model I settled on has a parameter for the qualifying time difference between riders, and further to model tournament outcomes I need to know qualifying positions. Since at this point these are unknown, I've run the model with the assumption that all riders had an equal qualifying time, and then seeded them for the tournament in order of the strength returned from the Bradley-Terry model.

<aside>Much more detail about how Bradley-Terry strength parameters propogate to gold medal predictions to come.</aside>

The tables below detail the odds that were available to me on Unibet, the stakes I placed, and the expected return under my model.

::::: {.panelset}

::: {.panel}
[Men]{.panel-name}

```{r, echo = FALSE}
odds <- read_remote_target("kelly_strategy_Men")
probs <- read_remote_target("kelly_posterior_Men")
wealth <- 20
cap <- 20/6
```

Bets placed

```{r odds-table, echo = FALSE}
pre_qual_men <- read_csv("../../../track-cycling/data/bets/2020-08-04-Men-PreQualifying.csv")

pre_qual_men %>%
  filter(capped_kelly_stakes > 0) %>%
  select(`Athlete` = rider, `Odds` = fractional_odds, `Stake` = capped_kelly_stakes, `Modelled Gold Prob.` = gold_prob, `Expected Return`= expected_return) %>%
  kable("pipe", digits = 2)
```


<details>
<summary>All Other Odds</summary>
```{r other-odds, echo = FALSE}
pre_qual_men %>%
  filter(capped_kelly_stakes == 0) %>%
  select(`Athlete` = rider, `Odds` = fractional_odds, `Stake` = kelly_stakes, `Modelled Gold Prob.` = gold_prob, `Expected Return`= expected_return) %>%
  kable("pipe", digits = 2)
```
</details>
:::
:::::

## 1/24 Finals

::::: {.panelset}

::: {.panel}
[Men]{.panel-name}

```{r, echo = FALSE}
odds <- read_remote_target("kelly_strategy_Men")
probs <- read_remote_target("kelly_posterior_Men")
wealth <- 20
cap <- 20/6
```

Bets placed

```{r, echo = FALSE}
post_qual_men <- read_csv("../../../track-cycling/data/bets/2020-08-04-Men-PostQualifying.csv")

post_qual_men %>%
  filter(capped_kelly_stakes > 0) %>%
  select(`Athlete` = rider, `Odds` = fractional_odds, `Stake` = capped_kelly_stakes, `Modelled Gold Prob.` = gold_prob, `Expected Return`= expected_return) %>%
  kable("pipe", digits = 2)
```


<details>
<summary>All Other Odds</summary>
```{r , echo = FALSE}
post_qual_men %>%
  filter(capped_kelly_stakes == 0) %>%
  select(`Athlete` = rider, `Odds` = fractional_odds, `Stake` = kelly_stakes, `Modelled Gold Prob.` = gold_prob, `Expected Return`= expected_return) %>%
  kable("pipe", digits = 2)
```
</details>
:::
:::::


## Comments

## Acknowledgments {.appendix}


  
